<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Andreï V. Kostyrka, University of Luxembourg" />


<title>Choosing weights for likelihood smoothing</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>

<style type="text/css">
p.abstract{
text-align: center;
font-weight: bold;
}
div.abstract{
margin: auto;
width: 90%;
}
</style>


<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Choosing weights for likelihood
smoothing</h1>
<h4 class="author">Andreï V. Kostyrka, University of Luxembourg</h4>
<h4 class="date">Created: 2025-04-29, last modified: 2024-04-29,
compiled: 2025-10-27</h4>
<div class="abstract">
<p class="abstract">Abstract</p>
This vignette demonstrates how the choice of SEL weights for smoothing
the likelihood affects the final result.
</div>


<div id="TOC">
<ul>
<li><a href="#kernel-methods" id="toc-kernel-methods"><span class="toc-section-number">1</span> Kernel methods</a></li>
<li><a href="#simulation-in-1-dimension" id="toc-simulation-in-1-dimension"><span class="toc-section-number">2</span> Simulation in 1 dimension</a></li>
<li><a href="#simulation-in-3-dimensions" id="toc-simulation-in-3-dimensions"><span class="toc-section-number">3</span> Simulation in 3 dimensions</a></li>
<li><a href="#conclusion" id="toc-conclusion"><span class="toc-section-number">4</span> Conclusion</a></li>
<li><a href="#references" id="toc-references"><span class="toc-section-number">5</span> References</a></li>
</ul>
</div>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(smoothemplik)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#&gt; Smoothed Empirical Likelihood version 0.0.16 (2025-10-27).</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt; Package under active development; core functions subject to change.</span></span></code></pre></div>
<div id="kernel-methods" class="section level2" number="1">
<h2><span class="header-section-number">1</span> Kernel methods</h2>
<p>There are many approaches to choosing the smoothing weights for
conditional empirical likelihood, and there is no consensus on the
optimality of one or another weighting scheme.</p>
<p>Recall that in the SEL approach, the empirical likelihood of the data
in the observed sample is maximised subject to the constraint <span class="math inline">\(\mathbb{E}(\rho(Z, \theta) \mid X) = 0\)</span>.
Assume for simplicity that the dimension of the moment function <span class="math inline">\(\rho\)</span> is 1. The optimisation problem is
therefore finding the optimal discrete distribution that enforces a
sample analogue of this conditional moment restriction for any parameter
<span class="math inline">\(\theta\)</span>: <span class="math display">\[
\max_{0 &lt; p_{ij} &lt; 1} \sum_{i=1}^n \sum_{j=1}^n w_{ij} \log
p_{ij},
\]</span> where <span class="math inline">\(\sum_j p_{ij} = 1\)</span>
for <span class="math inline">\(i=1,\ldots,n\)</span> and <span class="math inline">\(\sum_j p_{ij}\rho(Z_j, \theta) = 0\)</span> for
<span class="math inline">\(i=1,\ldots,n\)</span>.</p>
<p>The solution to this problem has a closed form: <span class="math display">\[
\hat p_{ij} = \frac{w_{ij}}{1 + \hat\lambda_i (\theta) \rho(Z_j,
\theta)},
\]</span> where the Lagrange multipliers <span class="math inline">\(\hat\lambda_i\)</span> are the solution to the
equality <span class="math inline">\(\sum_{j=1}^n \frac{w_{ij} \rho(Z_j,
\theta)}{1 + \lambda_i(\theta) \rho(Z_j, \theta)} = 0\)</span> (the
first-order condition for maximising the weighted empirical likelihood),
found numerically.</p>
<p>Typically, <span class="math inline">\(w_{ij}\)</span> are kernel
weights. They can be obtained in a plethora of approaches:</p>
<ol style="list-style-type: decimal">
<li>Directly apply popular kernels to the conditioning variables <span class="math inline">\(X\)</span>;</li>
<li>Transform <span class="math inline">\(X\)</span> coordinate-wise via
any probability-integral-like transformation (empirical CDF, Gaussian
CDF etc.) to map them into the <span class="math inline">\([0, 1]^{\dim
X}\)</span> hyper-cubel;</li>
<li>For each <span class="math inline">\(X\)</span>, find its <span class="math inline">\(k\)</span> nearest neighbours, rank them by
proximity, and apply the kernel function to the ranks of the nearest
observations.</li>
<li>Choose the adaptive nearest-neighbour bandwidth <span class="math inline">\(b_n(X_i) = b_i\)</span> such that there be exactly
<span class="math inline">\(k\)</span> nearest neighbours in the
vicinity defined by the kernel, without any rank transformation.</li>
</ol>
<p>Theoretically, approaches (3) and (4) should work the best because it
ensures that there are enough observations for smoothing, and that there
is neither over- or under-smoothing. The latter two phenomena are a
problem:</p>
<ul>
<li>If the SEL bandwidth is too large, then, identification is lost
because the conditional moment restriction becomes an unconditional one
(‘the average residual is zero’), and the model parameters cannot be
estimated.</li>
<li>If SEL bandwidth is too narrow, then, there is not enough smoothing
of the likelihood; since the log-empirical-likelihood ratio is unbounded
from below, the values of the SELR statistic can become arbitrarily
small. In addition, too small a bandwidth limits the parameter space
severely because for the SELR statistic to be finite, there must be at
least one pair of opposite-sign residuals. This is known as the spanning
condition, which means that the convex hull of the data must contain the
zero,.</li>
</ul>
<p>Consider kernel weights of the form <span class="math display">\[
w_{ij} := k\left( \frac{X_i - X_j}{b} \right),
\]</span> where <span class="math inline">\(k\)</span> is a kernel
function that is zero outside <span class="math inline">\([-1,
1]\)</span>, integrates to one, and is symmetric and non-negative within
that interval. The most popular kernel functions are uniform, triangular
(Bartlett), quadratic (Epanechnikov), quartic, and Gaussian.</p>
<div id="fixed-bandwidth" class="section level3" number="1.1">
<h3><span class="header-section-number">1.1</span> Fixed bandwidth</h3>
<p>Using a fixed bandwidth for SEL smoothing is the simplest choice, yet
it can be sub-optimal for many reasons. In the regions where the
observations are dense, the empirical likelihood may be over-smoothed,
whereas in low-density regions, it may be undersmoothed, creating
problems for the spanning condition.</p>
<p>The obvious ‘crutch’ to fix the spanning condition failure is the use
of some sort of extrapolation of the SELR function outside the convex
hull. The present package offers three options for the <code>EL()</code>
function: <code>chull.fail = &quot;taylor&quot;</code> that extrapolates its
branches quadratically following a Taylor expansion after a cut-off
point, or <code>chull.fail = &quot;wald&quot;</code> that replaces the SELR
function halfway between the outermost observations with a smooth
transition to a Wald approximation, or <code>chull.fail = &quot;none&quot;</code>
for returning <code>-Inf</code>. This option is experimental; envisioned
are such options as 2nd- or 4th-order log-approximation. Adjusted EL
(AEL) and Balanced AEL (BAEL) can be invoked with
<code>chull.fail = &quot;adjusted&quot;</code> (<span class="citation">Chen et al.
(2008)</span>), <code>chull.fail = &quot;adjusted2&quot;</code> (<span class="citation">Liu and Chen (2010)</span> improvement), and
<code>chull.fail = &quot;balanced&quot;</code> (<span class="citation">Emerson and
Owen (2009)</span>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>x  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>ct <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>grid.full <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">5.5</span>, <span class="at">length.out =</span> <span class="dv">201</span>))</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>grid.keep <span class="ot">&lt;-</span> grid.full <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">2.5</span> <span class="sc">|</span> grid.full <span class="sc">&gt;=</span> <span class="fl">3.5</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>selr0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(grid.full, <span class="cf">function</span>(m) <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">EL0</span>(x, m, ct)<span class="sc">$</span>logelr)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>selr1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">ExEL1</span>(x, <span class="at">mu =</span> grid.full, <span class="at">ct =</span> ct, <span class="at">exel.control =</span> <span class="fu">list</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">3.5</span>)))</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>selr2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">ExEL2</span>(x, <span class="at">mu =</span> grid.full, <span class="at">ct =</span> ct, <span class="at">exel.control =</span> <span class="fu">list</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">3.5</span>)))</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="fu">plot</span>(grid.full, selr0, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">4.5</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;-2 * weighted log-EL&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="fu">points</span>(grid.full[grid.keep], selr1[grid.keep], <span class="at">col =</span> <span class="dv">4</span>, <span class="at">pch =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">0.75</span>)</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="fu">points</span>(grid.full[grid.keep], selr2[grid.keep], <span class="at">col =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.75</span>)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="fu">rug</span>(x, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">3.5</span>), <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;top&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;Taylor&quot;</span>, <span class="st">&quot;Wald&quot;</span>), <span class="at">title =</span> <span class="st">&quot;Extrapolation type&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>These extrapolations may certainly remedy the predicament of having
negative infinity for the log-ELR statistic, which does not get accepted
by most numerical optimisers – but they should not be relied upon. It is
normal to have ‘bad’ values for ‘bad’ guesses during the optimisation
process, but at the initial value and at the optimum, the spanning
condition should hold.</p>
</div>
<div id="rank-weights" class="section level3" number="1.2">
<h3><span class="header-section-number">1.2</span> Rank weights</h3>
</div>
<div id="nearest-neigbour-weights" class="section level3" number="1.3">
<h3><span class="header-section-number">1.3</span> Nearest-neigbour
weights</h3>
<p>This bandwidth is also known as the ‘baloon’ / sample-point adaptive
bandwidth. Define a function that chooses such a bandwidth that there be
<code>ceiling(d/n)</code> nearest neighbours for each observation, where
<code>d</code> is the span in <code>(0, 1)</code>. It is assumed that
the kernel in question has bounded support and is zero outside <span class="math inline">\([-1, 1]\)</span>. This version works for multiple
dimensions as well.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>pickMinBW <span class="ot">&lt;-</span> <span class="cf">function</span>(X, <span class="at">d =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">NROW</span>(X)), <span class="at">tol =</span> <span class="fl">1e-12</span>) {</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(d <span class="sc">*</span> n)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">min</span>(k, n <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="co"># has.ms &lt;- requireNamespace(&quot;matrixStats&quot;, quietly = TRUE)</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq_len</span>(n), <span class="cf">function</span>(i) {</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="co"># L_inf distances from X_i</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    A  <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sweep</span>(X, <span class="dv">2</span>, X[i, ], <span class="st">&quot;-&quot;</span>, <span class="at">check.margin =</span> <span class="cn">FALSE</span>))</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    <span class="co"># Di &lt;- if (has.ms) matrixStats::rowMaxs(A) else do.call(pmax, as.data.frame(A))</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    Di <span class="ot">&lt;-</span> <span class="fu">do.call</span>(pmax, <span class="fu">as.data.frame</span>(A))</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    Di[i] <span class="ot">&lt;-</span> <span class="cn">Inf</span>  <span class="co"># Exclude self</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="sc">&lt;</span> n <span class="sc">-</span> <span class="dv">1</span>) {</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">sort</span>(Di, <span class="at">partial =</span> k <span class="sc">+</span> <span class="dv">1</span>)[k <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">sort</span>(Di, <span class="at">partial =</span> n <span class="sc">-</span> <span class="dv">1</span>)[n <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    }</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  })</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  b <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> tol)</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="simulation-in-1-dimension" class="section level2" number="2">
<h2><span class="header-section-number">2</span> Simulation in 1
dimension</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">rchisq</span>(n, <span class="at">df =</span> <span class="dv">3</span>))</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> X <span class="sc">+</span> (<span class="fu">rchisq</span>(n, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">-</span> <span class="dv">3</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> X)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>vhat0 <span class="ot">&lt;-</span> <span class="fu">kernelSmooth</span>(X, mod0<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>, <span class="at">bw =</span> <span class="fu">max</span>(<span class="fu">diff</span>(X))<span class="sc">*</span><span class="fl">1.2</span>, <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">weights =</span> <span class="dv">1</span> <span class="sc">/</span> vhat0)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="fu">plot</span>(X, Y, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="fu">abline</span>(mod0, <span class="at">col =</span> <span class="dv">1</span>); <span class="fu">abline</span>(mod1, <span class="at">col =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">OLS =</span> mod0<span class="sc">$</span>coefficients, <span class="at">WOLS =</span> mod1<span class="sc">$</span>coefficients)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt;                   OLS      WOLS</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; (Intercept) 2.0887343 1.4469218</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; X           0.2858387 0.5054064</span></span></code></pre></div>
<p>These values are relatively far away from the truth.</p>
<p>Define four smoothing matrices:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>bw0 <span class="ot">&lt;-</span> <span class="fu">bw.CV</span>(X, <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>bw0 <span class="ot">&lt;-</span> <span class="fu">max</span>(bw0, <span class="fu">max</span>(<span class="fu">diff</span>(X))<span class="sc">*</span><span class="fl">1.1</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>wF <span class="ot">&lt;-</span> <span class="fu">kernelWeights</span>(X, <span class="at">bw =</span> bw0, <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co"># Assuming Gaussian CDF, which is not true</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>Xs <span class="ot">&lt;-</span> <span class="fu">scale</span>(X)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>XP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(Xs)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>wP <span class="ot">&lt;-</span> <span class="fu">kernelWeights</span>(XP, <span class="at">bw =</span> <span class="fu">bw.CV</span>(XP), <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="fu">rowMeans</span>(wP <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span>n</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;  [1] 0.14 0.16 0.20 0.24 0.26 0.28 0.28 0.28 0.26 0.26 0.28 0.28 0.28 0.28 0.30</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; [16] 0.26 0.24 0.24 0.22 0.22 0.22 0.22 0.22 0.18 0.16 0.14 0.10 0.04 0.06 0.06</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; [31] 0.08 0.12 0.14 0.12 0.16 0.18 0.22 0.22 0.18 0.18 0.16 0.14 0.16 0.22 0.14</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; [46] 0.12 0.12 0.12 0.12 0.10</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>bw.adapt <span class="ot">&lt;-</span> <span class="fu">pickMinBW</span>(X, <span class="at">d =</span> <span class="fl">0.16</span>)</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="fu">plot</span>(X, bw.adapt, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Adaptive bandwidth ensuring 15% non-zero weights&quot;</span>,</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(bw.adapt)))</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>wA <span class="ot">&lt;-</span> <span class="fu">kernelWeights</span>(X, <span class="at">bw =</span> bw.adapt, <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">rowMeans</span>(wA <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span>n</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt;  [1] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; [16] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; [31] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; [46] 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>rX <span class="ot">&lt;-</span> <span class="fu">rank</span>(X)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>wNN <span class="ot">&lt;-</span> <span class="fu">kernelWeights</span>(rX<span class="sc">/</span><span class="fu">max</span>(rX), <span class="at">bw =</span> <span class="fl">0.09</span>, <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="fu">rowMeans</span>(wNN <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span>n</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt;  [1] 0.08 0.10 0.12 0.14 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; [16] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; [31] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; [46] 0.16 0.14 0.12 0.10 0.08</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>g  <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, ...) Y <span class="sc">-</span> theta[<span class="dv">1</span>] <span class="sc">-</span> theta[<span class="dv">2</span>]<span class="sc">*</span>X</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>wF <span class="ot">&lt;-</span> wF <span class="sc">/</span> <span class="fu">rowSums</span>(wF)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>wP <span class="ot">&lt;-</span> wP <span class="sc">/</span> <span class="fu">rowSums</span>(wP)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>wNN <span class="ot">&lt;-</span> wNN <span class="sc">/</span> <span class="fu">rowSums</span>(wNN)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>wA <span class="ot">&lt;-</span> wA <span class="sc">/</span> <span class="fu">rowSums</span>(wA)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">smoothEmplik</span>(<span class="at">rho =</span> g, <span class="at">theta =</span> theta, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sel.weights =</span> wF, <span class="at">minus =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;EuL&quot;</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">smoothEmplik</span>(<span class="at">rho =</span> g, <span class="at">theta =</span> theta, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sel.weights =</span> wP, <span class="at">minus =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;EuL&quot;</span>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>g3 <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">smoothEmplik</span>(<span class="at">rho =</span> g, <span class="at">theta =</span> theta, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sel.weights =</span> wNN, <span class="at">minus =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;EuL&quot;</span>)</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>g4 <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">smoothEmplik</span>(<span class="at">rho =</span> g, <span class="at">theta =</span> theta, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sel.weights =</span> wA, <span class="at">minus =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;EuL&quot;</span>)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  </span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>th1  <span class="ot">&lt;-</span> <span class="fu">optim</span>(mod1<span class="sc">$</span>coefficients, g1, <span class="at">method =</span> <span class="st">&quot;BFGS&quot;</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">ndeps =</span> <span class="fu">rep</span>(<span class="fl">1e-5</span>, <span class="dv">2</span>), <span class="at">reltol =</span> <span class="fl">1e-5</span>))</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>th2  <span class="ot">&lt;-</span> <span class="fu">optim</span>(mod1<span class="sc">$</span>coefficients, g2, <span class="at">method =</span> <span class="st">&quot;BFGS&quot;</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">ndeps =</span> <span class="fu">rep</span>(<span class="fl">1e-5</span>, <span class="dv">2</span>), <span class="at">reltol =</span> <span class="fl">1e-5</span>))</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>th3  <span class="ot">&lt;-</span> <span class="fu">optim</span>(mod1<span class="sc">$</span>coefficients, g3, <span class="at">method =</span> <span class="st">&quot;BFGS&quot;</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">ndeps =</span> <span class="fu">rep</span>(<span class="fl">1e-5</span>, <span class="dv">2</span>), <span class="at">reltol =</span> <span class="fl">1e-5</span>))</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>th4  <span class="ot">&lt;-</span> <span class="fu">optim</span>(mod1<span class="sc">$</span>coefficients, g4, <span class="at">method =</span> <span class="st">&quot;BFGS&quot;</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">ndeps =</span> <span class="fu">rep</span>(<span class="fl">1e-5</span>, <span class="dv">2</span>), <span class="at">reltol =</span> <span class="fl">1e-5</span>))</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">WOLS =</span> mod1<span class="sc">$</span>coefficients, <span class="at">Fixed =</span> th1<span class="sc">$</span>par, <span class="at">PIT =</span> th2<span class="sc">$</span>par, <span class="at">NNeighb =</span> th3<span class="sc">$</span>par, <span class="at">Adapt =</span> th4<span class="sc">$</span>par)</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt;                  WOLS     Fixed       PIT   NNeighb     Adapt</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt; (Intercept) 1.4469218 1.6509595 1.4592058 1.6426623 0.8895890</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt; X           0.5054064 0.4119324 0.5326892 0.3026498 0.6117477</span></span></code></pre></div>
</div>
<div id="simulation-in-3-dimensions" class="section level2" number="3">
<h2><span class="header-section-number">3</span> Simulation in 3
dimensions</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rchisq</span>(n<span class="sc">*</span><span class="dv">3</span>, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">rowSums</span>(X) <span class="sc">+</span> (<span class="fu">rchisq</span>(n, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">-</span> <span class="dv">3</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">rowSums</span>(X))</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>vhat0 <span class="ot">&lt;-</span> <span class="fu">kernelSmooth</span>(X, mod0<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>, <span class="at">PIT =</span> <span class="cn">TRUE</span>, <span class="at">bw =</span> <span class="fl">0.2</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>, <span class="at">no.dedup =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">weights =</span> <span class="dv">1</span> <span class="sc">/</span> vhat0)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">OLS =</span> mod0<span class="sc">$</span>coefficients, <span class="at">WOLS =</span> mod1<span class="sc">$</span>coefficients)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt;                   OLS       WOLS</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; (Intercept) 4.1866397 0.16631928</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; X1          0.6251463 0.05875198</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; X2          0.7362969 0.99137344</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; X3          0.2928678 0.75248132</span></span></code></pre></div>
<p>These values are also far away from the truth.</p>
<p>Construct the same four smoothing matrices:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>bw0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>atleast2 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="cf">while</span>(<span class="sc">!</span>atleast2) {</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a> wF <span class="ot">&lt;-</span> <span class="fu">kernelWeights</span>(X, <span class="at">bw =</span> bw0, <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a> bw0 <span class="ot">&lt;-</span> bw0 <span class="sc">*</span> <span class="fl">1.1</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a> atleast2 <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">rowSums</span>(wF <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>}</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="fu">rowMeans</span>(wF <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span>n</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt;   [1] 0.535 0.390 0.070 0.570 0.070 0.665 0.260 0.645 0.555 0.630 0.555 0.635</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;  [13] 0.075 0.685 0.700 0.245 0.665 0.175 0.340 0.225 0.430 0.580 0.595 0.035</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;  [25] 0.255 0.360 0.565 0.575 0.430 0.430 0.280 0.330 0.545 0.585 0.525 0.575</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt;  [37] 0.730 0.145 0.645 0.095 0.280 0.585 0.560 0.600 0.565 0.490 0.640 0.600</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;  [49] 0.270 0.545 0.375 0.545 0.055 0.790 0.605 0.685 0.675 0.660 0.675 0.550</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt;  [61] 0.395 0.025 0.820 0.595 0.295 0.760 0.310 0.565 0.660 0.435 0.465 0.460</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt;  [73] 0.825 0.365 0.695 0.035 0.580 0.500 0.675 0.585 0.620 0.575 0.115 0.640</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt;  [85] 0.675 0.180 0.195 0.095 0.035 0.220 0.515 0.570 0.755 0.015 0.555 0.715</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt;  [97] 0.330 0.635 0.120 0.600 0.680 0.595 0.545 0.650 0.655 0.610 0.590 0.470</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; [109] 0.530 0.665 0.645 0.045 0.670 0.025 0.135 0.680 0.260 0.680 0.650 0.355</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt; [121] 0.175 0.445 0.555 0.665 0.115 0.260 0.460 0.680 0.455 0.065 0.495 0.090</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt; [133] 0.585 0.625 0.635 0.005 0.010 0.515 0.700 0.215 0.405 0.180 0.030 0.190</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#&gt; [145] 0.555 0.300 0.565 0.040 0.520 0.640 0.580 0.640 0.215 0.300 0.640 0.285</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">#&gt; [157] 0.660 0.485 0.380 0.325 0.710 0.495 0.500 0.480 0.555 0.625 0.345 0.690</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co">#&gt; [169] 0.330 0.615 0.400 0.665 0.185 0.665 0.545 0.325 0.465 0.645 0.555 0.170</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co">#&gt; [181] 0.645 0.065 0.625 0.495 0.620 0.535 0.480 0.130 0.600 0.735 0.060 0.120</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="co">#&gt; [193] 0.280 0.535 0.670 0.260 0.550 0.595 0.410 0.310</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">rowSums</span>(wF <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>Xs <span class="ot">&lt;-</span> <span class="fu">scale</span>(X)</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>XP <span class="ot">&lt;-</span> <span class="fu">apply</span>(Xs, <span class="dv">2</span>, pnorm)</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>wP <span class="ot">&lt;-</span> <span class="fu">kernelWeights</span>(XP, <span class="at">bw =</span> <span class="fu">bw.rot</span>(XP)<span class="sc">*</span><span class="dv">2</span>, <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>)</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a><span class="fu">rowMeans</span>(wP <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span>n</span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a><span class="co">#&gt;   [1] 0.140 0.045 0.025 0.155 0.020 0.105 0.035 0.245 0.115 0.165 0.120 0.310</span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="co">#&gt;  [13] 0.065 0.075 0.170 0.040 0.060 0.085 0.065 0.065 0.105 0.115 0.180 0.070</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a><span class="co">#&gt;  [25] 0.095 0.050 0.190 0.145 0.055 0.115 0.105 0.030 0.090 0.145 0.065 0.120</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a><span class="co">#&gt;  [37] 0.120 0.065 0.170 0.055 0.035 0.060 0.155 0.135 0.225 0.160 0.155 0.160</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a><span class="co">#&gt;  [49] 0.080 0.115 0.085 0.185 0.030 0.130 0.135 0.210 0.115 0.245 0.255 0.215</span></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a><span class="co">#&gt;  [61] 0.105 0.020 0.095 0.240 0.035 0.155 0.045 0.185 0.165 0.100 0.090 0.095</span></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a><span class="co">#&gt;  [73] 0.040 0.055 0.070 0.065 0.190 0.065 0.100 0.125 0.175 0.200 0.045 0.140</span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a><span class="co">#&gt;  [85] 0.080 0.060 0.035 0.035 0.080 0.070 0.175 0.155 0.030 0.025 0.225 0.145</span></span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a><span class="co">#&gt;  [97] 0.065 0.130 0.055 0.130 0.320 0.105 0.190 0.135 0.170 0.155 0.180 0.065</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a><span class="co">#&gt; [109] 0.060 0.225 0.210 0.020 0.185 0.065 0.015 0.280 0.050 0.210 0.170 0.110</span></span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a><span class="co">#&gt; [121] 0.040 0.055 0.185 0.195 0.070 0.060 0.060 0.095 0.125 0.025 0.180 0.030</span></span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a><span class="co">#&gt; [133] 0.195 0.165 0.250 0.035 0.080 0.130 0.155 0.080 0.050 0.085 0.015 0.060</span></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a><span class="co">#&gt; [145] 0.150 0.050 0.155 0.025 0.125 0.190 0.225 0.195 0.045 0.060 0.245 0.065</span></span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a><span class="co">#&gt; [157] 0.285 0.065 0.125 0.045 0.230 0.175 0.170 0.100 0.185 0.180 0.070 0.195</span></span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a><span class="co">#&gt; [169] 0.085 0.240 0.045 0.175 0.030 0.260 0.110 0.125 0.125 0.105 0.205 0.045</span></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a><span class="co">#&gt; [181] 0.055 0.050 0.100 0.105 0.170 0.165 0.050 0.060 0.185 0.085 0.025 0.070</span></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a><span class="co">#&gt; [193] 0.065 0.110 0.075 0.090 0.215 0.220 0.075 0.095</span></span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">rowSums</span>(wP <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a>bw.adapt <span class="ot">&lt;-</span> <span class="fu">pickMinBW</span>(X, <span class="at">d =</span> <span class="fl">0.16</span>)</span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">rowMeans</span>(X), bw.adapt, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Adaptive bandwidth ensuring 15% non-zero weights&quot;</span>,</span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(bw.adapt)))</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>wA <span class="ot">&lt;-</span> <span class="fu">kernelWeights</span>(X, <span class="at">bw =</span> bw.adapt, <span class="at">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">rowMeans</span>(wA <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span>n</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt;   [1] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt;  [16] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt;  [31] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt;  [46] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt;  [61] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt;  [76] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt;  [91] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; [106] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; [121] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; [136] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; [151] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt; [166] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt; [181] 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; [196] 0.16 0.16 0.16 0.16 0.16</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">rowSums</span>(wA <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; [1] 33</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>g  <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, ...) Y <span class="sc">-</span> <span class="fu">drop</span>(<span class="fu">cbind</span>(<span class="dv">1</span>, X) <span class="sc">%*%</span> theta)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>wF <span class="ot">&lt;-</span> wF <span class="sc">/</span> <span class="fu">rowSums</span>(wF)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>wP <span class="ot">&lt;-</span> wP <span class="sc">/</span> <span class="fu">rowSums</span>(wP)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>wA <span class="ot">&lt;-</span> wA <span class="sc">/</span> <span class="fu">rowSums</span>(wA)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">smoothEmplik</span>(<span class="at">rho =</span> g, <span class="at">theta =</span> theta, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sel.weights =</span> wF,</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>                                   <span class="at">minus =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;EuL&quot;</span>)</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">smoothEmplik</span>(<span class="at">rho =</span> g, <span class="at">theta =</span> theta, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sel.weights =</span> wP,</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>                                   <span class="at">minus =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;EuL&quot;</span>)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>g4 <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">smoothEmplik</span>(<span class="at">rho =</span> g, <span class="at">theta =</span> theta, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sel.weights =</span> wA,</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>                                   <span class="at">minus =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;EuL&quot;</span>)</span></code></pre></div>
<p>To save speed (30 seconds), we do not run the following fragment; the
results are provided below.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># th1  &lt;- optim(mod1$coefficients, g1, method = &quot;BFGS&quot;, control = list(ndeps = rep(1e-5, 4)))</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co"># th2  &lt;- optim(mod1$coefficients, g2, method = &quot;BFGS&quot;, control = list(ndeps = rep(1e-5, 4)))</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># th4  &lt;- optim(mod1$coefficients, g4, method = &quot;BFGS&quot;, control = list(ndeps = rep(1e-5, 4)))</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co"># round(cbind(True = rep(1, 4), WOLS = mod1$coefficients, Fixed = th1$par, PIT = th2$par, Adapt = th4$par), 3)</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#             True  WOLS Fixed    PIT Adapt</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># (Intercept)    1 0.166 2.755  3.668 0.110</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co"># X1             1 0.059 0.132  0.241 0.790</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co"># X2             1 0.991 1.036  0.694 0.929</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co"># X3             1 0.752 0.625 -0.161 0.863</span></span></code></pre></div>
</div>
<div id="conclusion" class="section level2" number="4">
<h2><span class="header-section-number">4</span> Conclusion</h2>
<p>This simulation emphasises the importance of careful bandwidth choice
in efficient estimation via smoothing the empirical or Euclidean
likelihood. Nearest-neighbour methods work well, whereas
adaptive-bandwidth methods are comparable to them, but also possess
lucrative theoretical proofs such as integrability.</p>
</div>
<div id="references" class="section level2" number="5">
<h2><span class="header-section-number">5</span> References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-chen2008adjusted" class="csl-entry">
Chen, Jiahua, Asokan Mulayath Variyath, and Bovas Abraham. 2008.
<span>“Adjusted Empirical Likelihood and Its Properties.”</span>
<em>Journal of Computational and Graphical Statistics</em> 17 (2):
426–43. <a href="https://doi.org/10.1198/106186008x321068">https://doi.org/10.1198/106186008x321068</a>.
</div>
<div id="ref-emerson2009calibration" class="csl-entry">
Emerson, Sarah C., and Art B. Owen. 2009. <span>“Calibration of the
Empirical Likelihood Method for a Vector Mean.”</span> <em>Electronic
Journal of Statistics</em> 3: 1161–92. <a href="https://doi.org/10.1214/09-ejs518">https://doi.org/10.1214/09-ejs518</a>.
</div>
<div id="ref-liu2010adjusted" class="csl-entry">
Liu, Yukun, and Jiahua Chen. 2010. <span>“Adjusted Empirical Likelihood
with High-Order Precision.”</span> <em>The Annals of Statistics</em> 38
(3). <a href="https://doi.org/10.1214/09-aos750">https://doi.org/10.1214/09-aos750</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
